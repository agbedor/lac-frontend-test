<div class="gradient-bg"></div>
<div class="dashboard-background">
    <ng-container *ngIf="userGroup === 'Manager'">
        <div class="manager-wrapper">
            <div class="container" *ngIf="!selectedApp">
                <section class="head">
                    <div class="sn">
                        <h1>Legal Aid Applications</h1>
                        <p>Manage and track all submitted applications</p>
                    </div>
                    <div class="toolbar">
                        <div class="search">
                            <img class="img" src="assets/images/search.png" alt="Apartment photo" />
                            <input #inputRef type="text" placeholder="Search by case number, applicant name"
                                class="search-input" (input)="onSearch($event)" autofocus />
                        </div>
                        <div class="dd">
                            <select class="dds">
                                <option [ngValue]="null">All Case Types</option>
                                <option *ngFor="let casetype of casetypes()" [ngValue]="casetype">
                                    {{ casetype.name }}
                                </option>
                            </select>
                            <select class="dds" [(ngModel)]="selectedStatus"
                                (change)="filterApplications(selectedStatus)">
                                <option value="all">All Status</option>
                                <option value="accepted">Accepted</option>
                                <option value="rejected">Rejected</option>
                                <option value="in progress">In Progress</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                    </div>
                </section>
                <section class="body">
                    <div class="card">
                        <div class="main">
                            <p>Total Applications</p>
                            <div class="count">
                                <h1>
                                    {{ applicationCount() }} </h1>
                                <div class="percent2">
                                    <i class="fa-solid fa-arrow-trend-down"></i>
                                    <p>
                                        7%
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="side">
                            <p>From Jan 01 2025 - July 10 2025</p>
                        </div>
                    </div>
                    <div class="card">
                        <div class="main">
                            <p>Accepted</p>
                            <div class="count">
                                <h1>
                                    {{ accCount() }}
                                </h1>
                                <div class="percent">
                                    <i class="fa-solid fa-arrow-trend-up"></i>
                                    <p>
                                        70%
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="side">
                            <p>From Jan 01 2025 - July 10 2025</p>
                        </div>
                    </div>
                    <div class="card">
                        <div class="main">
                            <p>In Progress</p>
                            <div class="count">
                                <h1>
                                    {{ inpCount() }}
                                </h1>
                                <div class="percent2">
                                    <i class="fa-solid fa-arrow-trend-down"></i>
                                    <p>
                                        20%
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="side">
                            <p>From Jan 01 2025 - July 10 2025</p>
                        </div>
                    </div>
                    <div class="card">
                        <div class="main">
                            <p>Completed
                            </p>
                            <div class="count">
                                <h1>
                                    {{ compCount() }}
                                </h1>
                                <div class="percent">
                                    <i class="fa-solid fa-arrow-trend-up"></i>
                                    <p>
                                        100%
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="side">
                            <p>From Jan 01 2025 - July 10 2025</p>
                        </div>
                    </div>
                </section>
                <!-- <section class="body">
                    <div class="card total-card">
                        <div class="main">
                            <p>Total Applications</p>
                            <div class="count">
                                <h1>
                                    {{ applicationCount() }} </h1>
                                <div class="percent2">
                                    <i class="fa-solid fa-arrow-trend-down"></i>
                                    <p>
                                        7%
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="side">
                            <p>From Jan 01 2025 - July 10 2025</p>
                        </div>
                    </div>
                    <div class="card accepted-card">
                        <div class="main">
                            <p style="color: green;">Accepted</p>
                            <div class="count">
                                <h1>
                                    {{ accCount() }}
                                </h1>
                                <div class="percent">
                                    <i class="fa-solid fa-arrow-trend-up"></i>
                                    <p>
                                        70%
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="side">
                            <p>From Jan 01 2025 - July 10 2025</p>
                        </div>
                    </div>
                    <div class="card progress-card">
                        <div class="main">
                            <p style="color: orangered;">In Progress</p>
                            <div class="count">
                                <h1>
                                    {{ inpCount() }}
                                </h1>
                                <div class="percent2">
                                    <i class="fa-solid fa-arrow-trend-down"></i>
                                    <p>
                                        20%
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="side">
                            <p>From Jan 01 2025 - July 10 2025</p>
                        </div>
                    </div>
                    <div class="card completed-card">
                        <div class="main">
                            <p style="color: blue;">Completed
                            </p>
                            <div class="count">
                                <h1>
                                    {{ compCount() }}
                                </h1>
                                <div class="percent">
                                    <i class="fa-solid fa-arrow-trend-up"></i>
                                    <p>
                                        100%
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="side">
                            <p>From Jan 01 2025 - July 10 2025</p>
                        </div>
                    </div>
                </section> -->
                <section class="tail">
                    <div class="header">
                        <p>
                            Applicant Name
                        </p>
                        <p>
                            Case Number
                        </p>
                        <p>
                            Type
                        </p>
                        <p>
                            Applicant Status
                        </p>
                        <p>
                            Submitted On
                        </p>
                        <p class="k">
                            Action
                        </p>
                    </div>
                    <mat-divider></mat-divider>

                    <div class="middle">
                        <!-- Loading -->
                        <div class="load" *ngIf="loading()">
                            <p class="loading-text">Loading applications...</p>
                        </div>

                        <!-- When Not Loading -->
                        <ng-container *ngIf="!loading()">
                            <ng-container *ngIf="displayedApps().length > 0; else noData">
                                <div class="app" *ngFor="let app of displayedApps()">
                                    <p>{{ app.title?.name }} {{ app.first_name }} {{ app.last_name }}</p>
                                    <p>{{ app.id }}</p>
                                    <div class="type">
                                        <p [class]="app.case.case_type.name">
                                            {{ app.case.case_type.name }}
                                        </p>
                                    </div>
                                    <div class="status">
                                        <p [class]="app.status">
                                            {{ app.status }}
                                        </p>
                                    </div>
                                    <p>{{ app.case.created_at | date:"yyyy-MM-dd 'at' hh:mm a" }}</p>
                                    <i (click)="viewDetails(app)" class="fa-regular fa-eye"></i>
                                </div>
                            </ng-container>
                        </ng-container>

                        <!-- No Data -->
                        <ng-template #noData>
                            <p class="no-data">No data available</p>
                        </ng-template>
                    </div>
                    <mat-divider></mat-divider>
                    <div class="footer">
                        <div class="bns">
                            <button class="btns" matTooltip="Previous" (click)="onPrev()"
                                [disabled]="applicationService.currentPage === 1">
                                Previous
                            </button>
                            <button class="btn" matTooltip="Next" (click)="onNext()"
                                [disabled]="applicationService.applications().length < applicationService.pageSize">
                                Next
                            </button>
                        </div>
                        <p>
                            Page 1 of 10
                        </p>
                    </div>
                </section>
            </div>

            <div class="detail-container" *ngIf="selectedApp">
                <section class="head">
                    <div class="directions">
                        <div class="arrows">
                            <i class="fa-solid fa-arrow-left-long" (click)="backToList()"></i>
                            <i class="fa-solid fa-arrow-right-long"></i>
                        </div>
                        <p>
                            Legal Aid Application
                        </p>
                    </div>
                    <div class="dets">
                        <div class="ac">
                            <h1>
                                PV-CAS-1509C4 {{ selectedApp.id }}
                            </h1>
                            <p>
                                {{ selectedApp.title?.name }} {{ selectedApp.first_name }} {{ selectedApp.last_name }}
                            </p>
                        </div>
                        <div class="ac">
                            <p>Submitted On:</p>
                            <p>{{ selectedApp.case.created_at | date:"yyyy-MM-dd 'at' hh:mm a" }}</p>
                        </div>
                    </div>
                </section>
                <mat-divider></mat-divider>
                <section class="tail" *ngIf="!actionMode; else actionSection">
                    <div class="middle">
                        <div class="per">
                            <p>Personal Information</p>
                        </div>
                        <div class="form-row">
                            <div>
                                <label class="input-label">
                                    Full Name
                                </label>
                                <input type="text" value="{{ selectedApp.first_name}} {{ selectedApp.last_name}}"
                                    class="custom-input" readonly />
                            </div>
                            <div>
                                <label class="input-label">
                                    Date of Birth
                                </label>
                                <input type="text" value="{{ selectedApp.dob}}" class="custom-input" readonly />
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label class="input-label">
                                    Gender
                                </label>
                                <input type="text" value="{{ selectedApp.gender?.name}}" class="custom-input"
                                    readonly />
                            </div>
                            <div>
                                <label class="input-label">
                                    Nationality
                                </label>
                                <input type="text" value="{{ selectedApp.nationality?.name}}" class="custom-input"
                                    readonly />
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label class="input-label">
                                    ID Type
                                </label>
                                <input type="text" value="{{ selectedApp.id_type?.name}}" class="custom-input"
                                    readonly />
                            </div>
                            <div>
                                <label class="input-label">
                                    ID Number
                                </label>
                                <input type="text" value="{{ selectedApp.id_number}}" class="custom-input" readonly />
                            </div>
                        </div>
                        <div class="per">
                            <p>Contact & Residence Information</p>
                        </div>
                        <div class="form-row">
                            <div>
                                <label class="input-label">
                                    House Address
                                </label>
                                <input type="text" value="{{ selectedApp.address}}" class="custom-input" readonly />
                            </div>
                            <div>
                                <label class="input-label">
                                    Email
                                </label>
                                <input type="text" value="J{{ selectedApp.email}}" class="custom-input" readonly />
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label class="input-label">
                                    How long applicant lived there
                                </label>
                                <input type="text" value="{{ selectedApp.period_of_stay}}" class="custom-input"
                                    readonly />
                            </div>
                            <div>
                                <label class="input-label">
                                    Mobile Phone
                                </label>
                                <input type="text" value="{{ selectedApp.contact}}" class="custom-input" readonly />
                            </div>
                        </div>
                        <div class="per">
                            <p>Employment & Financial Details</p>
                        </div>
                        <div class="form-row">
                            <div>
                                <label class="input-label">
                                    Employment Status
                                </label>
                                <input type="text" value="{{selectedApp.employment_status.name}}" class="custom-input"
                                    readonly />
                            </div>
                            <div>
                                <label class="input-label">
                                    Monthly Income
                                </label>
                                <input type="text" value="{{selectedApp.work?.monthly_income || 'None'}}"
                                    class="custom-input" readonly />
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label class="input-label">
                                    Job Role/Occupation
                                </label>
                                <input type="text" value="{{selectedApp.work?.job?.name || 'None'}}"
                                    class="custom-input" readonly />
                            </div>
                            <div>
                                <label class="input-label">
                                    Highest Qualification
                                </label>
                                <input type="text" value="{{selectedApp.work?.qualification || 'None'}}"
                                    class="custom-input" readonly />
                            </div>
                        </div>
                        <div class="per">
                            <p>Legal Case Information</p>
                        </div>
                        <div class="form-row">
                            <div>
                                <label class="input-label">
                                    Case Type
                                </label>
                                <input type="text" value="{{ selectedApp.case.case_type.name}}" class="custom-input"
                                    readonly />
                            </div>
                            <div>
                                <label class="input-label">
                                    Most Serious Charge/Issue
                                </label>
                                <input type="text" value="{{ selectedApp.case.main_charge}}" class="custom-input"
                                    readonly />
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label class="input-label">
                                    Applicant role in the case
                                </label>
                                <input type="text" value="{{ selectedApp.case.opponent.party.name}}"
                                    class="custom-input" readonly />
                            </div>
                            <div>
                                <label class="input-label">
                                    Other Party’s Name
                                </label>
                                <input type="text"
                                    value="{{ selectedApp.case.opponent.first_name}} {{ selectedApp.case.opponent.last_name}}"
                                    class="custom-input" readonly />
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label class="input-label">
                                    Other Party’s Contact
                                </label>
                                <input type="text" value="{{ selectedApp.case.opponent.contact}}" class="custom-input"
                                    readonly />
                            </div>
                            <div>
                                <label class="input-label">
                                    Other Party’s Address
                                </label>
                                <input type="text" value="{{ selectedApp.case.opponent.address}}" class="custom-input"
                                    readonly />
                            </div>
                        </div>
                        <div class="per">
                            <p>Family Information</p>
                        </div>
                        <div class="form-row">
                            <div>
                                <label class="input-label">
                                    Spouse Name
                                </label>
                                <input type="text"
                                    value="{{ selectedApp.spouse?.first_name || 'None' }} {{ selectedApp.spouse?.last_name || '' }}"
                                    class="custom-input" readonly />
                            </div>
                            <div>
                                <label class="input-label">
                                    Number of Children
                                </label>
                                <input type="text" value="{{ selectedApp.children || 'None'}}" class="custom-input"
                                    readonly />
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label class="input-label">
                                    Spouse Occupation
                                </label>
                                <input type="text" value="{{ selectedApp.spouse?.job?.name || 'None' }}"
                                    class="custom-input" readonly />
                            </div>
                            <div>
                                <label class="input-label">
                                    Spouse Monthly Income
                                </label>
                                <input type="text" value="{{  selectedApp.spouse?.income || 'None' }}"
                                    class="custom-input" readonly />
                            </div>
                        </div>
                        <div class="per">
                            <p>Summary of Case</p>
                        </div>
                        <div class="form-row">
                            <div>
                                <label class="input-label">
                                    Case Summary
                                </label>
                                <input type="text" value="{{selectedApp.case.case_summary}}" class="custom-inputs"
                                    readonly />
                            </div>
                        </div>
                        <div class="per">
                            <div class="pdf">
                                <img class="img" src="assets/images/pdf.png" alt="Apartment photo" />
                                <div class="pr">
                                    <p>{{ selectedApp?.document ? (selectedApp.document | filename) : 'No File
                                        Available' }}</p>
                                    <!-- <p class="mb">4.9 MB – 100% uploaded</p> -->
                                </div>
                            </div>
                            <img class="img2" src="assets/images/down.png" alt="Apartment photo" />
                        </div>
                    </div>
                    <div class="end">
                        <button class="btns" matTooltip="Previous" *ngIf="selectedApp.status === 'accepted'"
                            (click)="enableActionMode(selectedApp)">
                            Take Action
                        </button>
                    </div>
                </section>
                <ng-template #actionSection>
                    <form [formGroup]="actionFormGroup">
                        <section class="tail2">
                            <div class="main">
                                <div class="per2">
                                    <img class="img" src="assets/images/doc.png" alt="Apartment photo" />
                                    <p>Action Details</p>
                                </div>
                                <div class="form-row">
                                    <div>
                                        <label class="input-label">
                                            Action to Be Taken <span class="required">*</span>
                                        </label>
                                        <input type="text" placeholder="acccept" class="custom-input" required
                                            formControlName="actionTakenCtrl" />
                                        <div class="error"
                                            *ngIf="actionFormGroup.get('actionTakenCtrl')?.touched && actionFormGroup.get('actionTakenCtrl')?.invalid">
                                            Required.
                                        </div>
                                    </div>
                                    <div>
                                        <label class="input-label">
                                            Official Name
                                        </label>
                                        <input type="text" value="Edmund Foley Esq." class="custom-input" readonly />
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div>
                                        <label class="input-label">
                                            Appointment Date <span class="required">*</span>
                                        </label>
                                        <input type="date" formControlName="dateCtrl" class="custom-input"
                                            [min]="tomorrow" required />
                                        <div class="error"
                                            *ngIf="actionFormGroup.get('dateCtrl')?.touched && actionFormGroup.get('dateCtrl')?.invalid">
                                            Required.
                                        </div>
                                    </div>
                                    <div>
                                        <label class="input-label">
                                            Appointment Time <span class="required">*</span>
                                        </label>
                                        <input placeholder="00:00" class="custom-input" formControlName="timeCtrl"
                                            [dropSpecialCharacters]="false" mask="00:00" required
                                            (blur)="validateTimeInput()" />
                                        <div class="error"
                                            *ngIf="actionFormGroup.get('timeCtrl')?.touched && actionFormGroup.get('timeCtrl')?.hasError('required')">
                                            Required.
                                        </div>
                                        <div class="error"
                                            *ngIf="actionFormGroup.get('timeCtrl')?.hasError('invalidTime')">
                                            Time must be between 00:00 and 23:59
                                        </div>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div>
                                        <label class="input-label">
                                            Digital Signature <span class="required">*</span>
                                        </label>
                                        <div class="upload">
                                            <img class="img" src="assets/images/sig.png" alt="Apartment photo" />
                                            <p>
                                                Upload your signature <strong>or drag and drop</strong>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="middle">
                                <div class="per2">
                                    <img class="img" src="assets/images/ass.png" alt="Apartment photo" />
                                    <p>Assignment Details</p>
                                </div>
                                <div class="form-row">
                                    <div>
                                        <label class="input-label">
                                            Assigned To <span class="required">*</span>
                                        </label>
                                        <select class="custom-input" formControlName="mediatorCtrl" required>
                                            <option [ngValue]="null">select mediator</option>
                                            <option *ngFor="let med of mediators()" [ngValue]="med">
                                                {{ med.first_name }} {{ med.last_name }}
                                            </option>
                                        </select>
                                        <div class="error"
                                            *ngIf="actionFormGroup.get('mediatorCtrl')?.touched && actionFormGroup.get('mediatorCtrl')?.invalid">
                                            Required.
                                        </div>
                                    </div>
                                    <!-- <div>
                                        <label class="input-label">
                                            Date Assigned <span class="required">*</span>
                                        </label>
                                        <input type="text" placeholder="2020-05-05" class="custom-input" required />
                                    </div> -->
                                </div>
                                <div class="form-row">
                                    <div>
                                        <label class="input-label">
                                            Digital Signature <span class="required">*</span>
                                        </label>
                                        <div class="upload" (click)="fileInput.click()" (dragover)="onDragOver($event)"
                                            (drop)="onDrop($event)">
                                            <img class="img" src="assets/images/sig.png" alt="Apartment photo" />
                                            <p>
                                                Upload your signature <strong>or drag and drop</strong>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <input type="file" #fileInput hidden (change)="onFileSelected($event)"
                                    accept=".pdf,.doc,.docx" />
                                <div *ngIf="fileError" class="error">{{ fileError }}</div>
                                <div *ngIf="selectedFile" class="file-info">
                                    <p>{{ selectedFile.name }} ({{ (selectedFile.size / 1024 / 1024).toFixed(2) }} MB)
                                    </p>
                                    <button type="button" (click)="removeFile()">Remove</button>
                                </div>
                            </div>
                            <div class="body">
                                <div class="start">
                                    <div class="per2">
                                        <img class="img" src="assets/images/remark.png" alt="Apartment photo" />
                                        <p>Remarks & Comments</p>
                                    </div>
                                    <div class="form-row">
                                        <div>
                                            <label class="input-label">
                                                Remarks/Comments <span class="required">*</span>
                                            </label>
                                            <input type="text"
                                                placeholder="Add detailed remarks, notes, or instructions"
                                                class="custom-inputs" required formControlName="remarksCtrl" required />
                                            <div class="error"
                                                *ngIf="actionFormGroup.get('remarksCtrl')?.touched && actionFormGroup.get('remarksCtrl')?.invalid">
                                                Required.
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div>
                                            <label class="input-label">
                                                Attachment
                                            </label>
                                            <div class="upload" (click)="fileInput.click()"
                                                (dragover)="onDragOver($event)" (drop)="onDrop($event)">
                                                <img class="img" src="assets/images/cloud.png" alt="Apartment photo" />
                                                <div>
                                                    <p>
                                                        Upload a document <strong>or drag and drop</strong>
                                                    </p>
                                                    <p>
                                                        Supported formats: PDF, Ms Word (Max. 5MB) </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <input type="file" #fileInput hidden (change)="onFileSelected($event)"
                                        accept=".pdf,.doc,.docx" />
                                    <div *ngIf="fileError" class="error">{{ fileError }}</div>
                                    <div *ngIf="selectedFile" class="file-info">
                                        <p>{{ selectedFile.name }} ({{ (selectedFile.size / 1024 / 1024).toFixed(2) }}
                                            MB)
                                        </p>
                                        <button type="button" (click)="removeFile()">Remove</button>
                                    </div>
                                </div>
                                <div class="end">
                                    <button class="btn" matTooltip="Previous" (click)="disableActionMode()">
                                        Cancel
                                    </button>
                                    <button class="btns" matTooltip="Previous" (click)="submit(actionFormGroup)">
                                        Save & Update
                                    </button>
                                </div>
                            </div>
                        </section>
                    </form>
                </ng-template>
            </div>
        </div>
    </ng-container>

    <ng-container *ngIf="userGroup === 'Mediator'">
        <div class="mediator-wrapper">
            <div class="container" *ngIf="!selectedApp">
                <section class="head">
                    <div class="prof">
                        <img class="img" src="assets/images/ava.png" alt="Apartment photo" />
                        <div class="sn">
                            <h1>{{username}}</h1>
                            <p>{{userGroup}}</p>
                        </div>
                    </div>
                    <div class="crow">
                        <div class="card total-card">
                            <img class="img" src="assets/images/doc.png" alt="Apartment photo" />
                            <div class="main">
                                <p class="tot">Total Cases</p>
                                <p class="count">
                                    {{ applicationCount() }}
                                </p>
                            </div>
                        </div>
                        <div class="card accepted-card">
                            <img class="img" src="assets/images/open.png" alt="Apartment photo" />
                            <div class="main">
                                <p class="tot" style="color: green;">Accepted</p>
                                <p class="count">
                                    {{ accCount() }}
                                </p>
                            </div>
                        </div>
                        <div class="card progress-card">
                            <img class="img" src="assets/images/prog.png" alt="Apartment photo" />
                            <div class="main">
                                <p class="tot" style="color: orangered;">In Progress</p>
                                <p class="count">
                                    {{ inpCount() }}
                                </p>
                            </div>
                        </div>
                        <div class="card completed-card">
                            <img class="img" src="assets/images/com.png" alt="Apartment photo" />
                            <div class="main">
                                <p class="tot" style="color: blue;">Completed</p>
                                <p class="count">
                                    {{ compCount() }}
                                </p>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="body">
                    <div class="toolbar">
                        <h3>My Assigned Cases</h3>
                        <div class="stat">
                            <div *ngFor="let status of statusOptions" (click)="filterApplications(status.value)"
                                [ngClass]="status.value === selectedStatus ? 'boxs' : 'box'">
                                <p>{{ status.label }}</p>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="tail">
                    <div class="header">
                        <p>
                            Case Number
                        </p>
                        <p>
                            Applicant Name
                        </p>
                        <p>
                            Type
                        </p>
                        <p>
                            Applicant Status
                        </p>
                        <p>
                            Date Assigned
                        </p>
                        <p class="k">
                            Action
                        </p>
                    </div>
                    <mat-divider></mat-divider>

                    <div class="middle">
                        <!-- Loading -->
                        <div class="load" *ngIf="loading()">
                            <p class="loading-text">Loading applications...</p>
                        </div>

                        <!-- When Not Loading -->
                        <ng-container *ngIf="!loading()">
                            <ng-container *ngIf="displayedApps().length > 0; else noData">
                                <div class="app" *ngFor="let app of displayedApps()">
                                    <p>{{ app.id }}</p>
                                    <p>{{ app.title?.name }} {{ app.first_name }} {{ app.last_name }}</p>
                                    <div class="type">
                                        <p [class]="app.case.case_type.name">
                                            {{ app.case.case_type.name }}
                                        </p>
                                    </div>
                                    <div class="status">
                                        <p [class]="app.status">
                                            {{ app.status }}
                                        </p>
                                    </div>
                                    <p>{{ app.case.created_at | date:"yyyy-MM-dd" }}</p>
                                    <i (click)="viewDetails(app)" class="fa-regular fa-eye"></i>
                                </div>
                            </ng-container>
                        </ng-container>

                        <!-- No Data -->
                        <ng-template #noData>
                            <p class="no-data">No data available</p>
                        </ng-template>
                    </div>

                    <mat-divider></mat-divider>
                    <div class="footer">
                        <div class="bns">
                            <button class="btns" matTooltip="Previous" (click)="onPrev()"
                                [disabled]="applicationService.currentPage === 1">
                                Previous
                            </button>
                            <button class="btn" matTooltip="Next" (click)="onNext()"
                                [disabled]="applicationService.applications().length < applicationService.pageSize">
                                Next
                            </button>
                        </div>
                        <p>
                            Page 1 of 10
                        </p>
                    </div>
                </section>
            </div>

            <div class="detail-container" *ngIf="selectedApp">
                <section class="head">
                    <div class="directions">
                        <div class="arrows">
                            <i class="fa-solid fa-arrow-left-long" (click)="backToList()"></i>
                            <i class="fa-solid fa-arrow-right-long"></i>
                        </div>
                        <p>
                            Legal Aid Application
                        </p>
                    </div>
                    <div class="dets">
                        <div class="ac">
                            <h1>
                                PV-CAS-1509C4 {{ selectedApp.id }}
                            </h1>
                            <p>
                                {{ selectedApp.title?.name }} {{ selectedApp.first_name }} {{ selectedApp.last_name }}
                            </p>
                        </div>
                        <div class="ac">
                            <p>Submitted On:</p>
                            <p>{{ selectedApp.case.created_at | date:"yyyy-MM-dd 'at' hh:mm a" }}</p>
                        </div>
                    </div>
                </section>
                <mat-divider></mat-divider>
                <section class="tail" *ngIf="!actionMode; else actionSection">
                    <div class="middle">
                        <div class="per">
                            <p>Applicant Information</p>
                        </div>
                        <div class="form-row">
                            <div>
                                <label class="input-label">
                                    Full Name
                                </label>
                                <input type="text" value="{{ selectedApp.first_name}} {{ selectedApp.last_name}}"
                                    class="custom-input" readonly />
                            </div>
                            <div>
                                <label class="input-label">
                                    ID Number
                                </label>
                                <input type="text" value="{{ selectedApp.id_number}}" class="custom-input" readonly />
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label class="input-label">
                                    Gender
                                </label>
                                <input type="text" value="{{ selectedApp.gender?.name}}" class="custom-input"
                                    readonly />
                            </div>
                            <div>
                                <label class="input-label">
                                    Mobile Phone
                                </label>
                                <input type="text" value="{{ selectedApp.contact}}" class="custom-input" readonly />
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label class="input-label">
                                    House Address
                                </label>
                                <input type="text" value="{{ selectedApp.address}}" class="custom-input" readonly />
                            </div>
                            <div>
                                <label class="input-label">
                                    Email
                                </label>
                                <input type="text" value="J{{ selectedApp.email}}" class="custom-input" readonly />
                            </div>
                        </div>
                        <div class="per">
                            <p>Case Details</p>
                        </div>
                        <div class="form-row">
                            <div>
                                <label class="input-label">
                                    Case Type
                                </label>
                                <input type="text" value="{{ selectedApp.case.case_type.name}}" class="custom-input"
                                    readonly />
                            </div>
                            <div>
                                <label class="input-label">
                                    Most Serious Charge/Issue
                                </label>
                                <input type="text" value="{{ selectedApp.case.main_charge}}" class="custom-input"
                                    readonly />
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label class="input-label">
                                    Applicant role in the case
                                </label>
                                <input type="text" value="{{ selectedApp.case.opponent.party.name}}"
                                    class="custom-input" readonly />
                            </div>
                            <div>
                                <label class="input-label">
                                    Other Party’s Name
                                </label>
                                <input type="text"
                                    value="{{ selectedApp.case.opponent.first_name}} {{ selectedApp.case.opponent.last_name}}"
                                    class="custom-input" readonly />
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label class="input-label">
                                    Other Party’s Contact
                                </label>
                                <input type="text" value="{{ selectedApp.case.opponent.contact}}" class="custom-input"
                                    readonly />
                            </div>
                            <div>
                                <label class="input-label">
                                    Other Party’s Address
                                </label>
                                <input type="text" value="{{ selectedApp.case.opponent.address}}" class="custom-input"
                                    readonly />
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label class="input-label">
                                    Case Summary
                                </label>
                                <input type="text" value="{{ selectedApp.case.case_summary}}" class="custom-inputs"
                                    readonly />
                            </div>
                        </div>
                        <div class="per2">
                            <img class="img" src="assets/images/remark.png" alt="Apartment photo" />
                            <p>Mediation Notes</p>
                        </div>
                        <div class="form-row">
                            <div>
                                <label class="input-labels">
                                    Remarks/Comments <span class="required">*</span>
                                </label>
                                <input type="text" placeholder="Add detailed remarks, notes, or instructions"
                                    class="customs-inputs" required formControlName="remarksCtrl" required />
                                <div class="error"
                                    *ngIf="actionFormGroup.get('remarksCtrl')?.touched && actionFormGroup.get('remarksCtrl')?.invalid">
                                    Required.
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label class="input-labels">
                                    Attachment
                                </label>
                                <div class="upload" (click)="fileInput.click()" (dragover)="onDragOver($event)"
                                    (drop)="onDrop($event)">
                                    <img class="img" src="assets/images/cloud.png" alt="Apartment photo" />
                                    <div>
                                        <p>
                                            Upload a document <strong>or drag and drop</strong>
                                        </p>
                                        <p>
                                            Supported formats: PDF, Ms Word (Max. 5MB) </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <input type="file" #fileInput hidden (change)="onFileSelected($event)"
                            accept=".pdf,.doc,.docx" />
                        <div *ngIf="fileError" class="error">{{ fileError }}</div>
                        <div *ngIf="selectedFile" class="file-info">
                            <p>{{ selectedFile.name }} ({{ (selectedFile.size / 1024 / 1024).toFixed(2) }} MB)
                            </p>
                            <button type="button" (click)="removeFile()">Remove</button>
                        </div>
                    </div>

                    <div class="end">
                        <button class="btns" matTooltip="Previous" (click)="enableActionMode(selectedApp)">
                            Save Notes
                        </button>
                    </div>
                </section>
                <ng-template #actionSection>
                    <form [formGroup]="actionFormGroup">
                        <div class="split">
                            <section class="tail">
                                <div class="middle">
                                    <div class="per">
                                        <p>Applicant Information</p>
                                    </div>
                                    <div class="form-row">
                                        <div>
                                            <label class="input-label">
                                                Full Name
                                            </label>
                                            <input type="text"
                                                value="{{ selectedApp.first_name}} {{ selectedApp.last_name}}"
                                                class="custom-input" readonly />
                                        </div>
                                        <div>
                                            <label class="input-label">
                                                ID Number
                                            </label>
                                            <input type="text" value="{{ selectedApp.id_number}}" class="custom-input"
                                                readonly />
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div>
                                            <label class="input-label">
                                                Gender
                                            </label>
                                            <input type="text" value="{{ selectedApp.gender?.name}}"
                                                class="custom-input" readonly />
                                        </div>
                                        <div>
                                            <label class="input-label">
                                                Mobile Phone
                                            </label>
                                            <input type="text" value="{{ selectedApp.contact}}" class="custom-input"
                                                readonly />
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div>
                                            <label class="input-label">
                                                House Address
                                            </label>
                                            <input type="text" value="{{ selectedApp.address}}" class="custom-input"
                                                readonly />
                                        </div>
                                        <div>
                                            <label class="input-label">
                                                Email
                                            </label>
                                            <input type="text" value="J{{ selectedApp.email}}" class="custom-input"
                                                readonly />
                                        </div>
                                    </div>
                                    <div class="per">
                                        <p>Case Details</p>
                                    </div>
                                    <div class="form-row">
                                        <div>
                                            <label class="input-label">
                                                Case Type
                                            </label>
                                            <input type="text" value="{{ selectedApp.case.case_type.name}}"
                                                class="custom-input" readonly />
                                        </div>
                                        <div>
                                            <label class="input-label">
                                                Most Serious Charge/Issue
                                            </label>
                                            <input type="text" value="{{ selectedApp.case.main_charge}}"
                                                class="custom-input" readonly />
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div>
                                            <label class="input-label">
                                                Applicant role in the case
                                            </label>
                                            <input type="text" value="{{ selectedApp.case.opponent.party.name}}"
                                                class="custom-input" readonly />
                                        </div>
                                        <div>
                                            <label class="input-label">
                                                Other Party’s Name
                                            </label>
                                            <input type="text"
                                                value="{{ selectedApp.case.opponent.first_name}} {{ selectedApp.case.opponent.last_name}}"
                                                class="custom-input" readonly />
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div>
                                            <label class="input-label">
                                                Other Party’s Contact
                                            </label>
                                            <input type="text" value="{{ selectedApp.case.opponent.contact}}"
                                                class="custom-input" readonly />
                                        </div>
                                        <div>
                                            <label class="input-label">
                                                Other Party’s Address
                                            </label>
                                            <input type="text" value="{{ selectedApp.case.opponent.address}}"
                                                class="custom-input" readonly />
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div>
                                            <label class="input-label">
                                                Case Summary
                                            </label>
                                            <input type="text" value="{{ selectedApp.case.case_summary}}"
                                                class="custom-inputs" readonly />
                                        </div>
                                    </div>
                                    <div class="per2">
                                        <img class="img" src="assets/images/remark.png" alt="Apartment photo" />
                                        <p>Mediation Notes</p>
                                    </div>
                                    <div class="form-row">
                                        <div>
                                            <label class="input-labels">
                                                Remarks/Comments <span class="required">*</span>
                                            </label>
                                            <input type="text"
                                                placeholder="Add detailed remarks, notes, or instructions"
                                                class="customs-inputs" required />
                                            <!-- <div class="error"
                                                *ngIf="actionFormGroup.get('remarksCtrl')?.touched && actionFormGroup.get('remarksCtrl')?.invalid">
                                                Required.
                                            </div> -->
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div>
                                            <label class="input-labels">
                                                Attachment
                                            </label>
                                            <div class="upload" (click)="fileInput.click()"
                                                (dragover)="onDragOver($event)" (drop)="onDrop($event)">
                                                <img class="img" src="assets/images/cloud.png" alt="Apartment photo" />
                                                <div>
                                                    <p>
                                                        Upload a document <strong>or drag and drop</strong>
                                                    </p>
                                                    <p>
                                                        Supported formats: PDF, Ms Word (Max. 5MB) </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <input type="file" #fileInput hidden (change)="onFileSelected($event)"
                                        accept=".pdf,.doc,.docx" />
                                    <div *ngIf="fileError" class="error">{{ fileError }}</div>
                                    <div *ngIf="selectedFile" class="file-info">
                                        <p>{{ selectedFile.name }} ({{ (selectedFile.size / 1024 / 1024).toFixed(2) }}
                                            MB)
                                        </p>
                                        <button type="button" (click)="removeFile()">Remove</button>
                                    </div>
                                </div>

                                <div class="end">
                                    <button class="btns" matTooltip="Previous" (click)="backToList()">
                                        Save Notes
                                    </button>
                                </div>
                            </section>
                            <section class="note">
                                <h3>
                                    Notes
                                </h3>
                                <div class="ns">
                                    <p>
                                        Initial contact made with both parties. Scheduling first mediation session for
                                        next
                                        week.
                                    </p>
                                    <div class="not">
                                        <p>Dr. Samuel Nkrumah</p>
                                        <p>01/03/2025</p>
                                    </div>
                                </div>
                                <div class="ns">
                                    <p>
                                        Initial contact made with both parties. Scheduling first mediation session for
                                        next
                                        week.
                                    </p>
                                    <div class="not">
                                        <p>Dr. Samuel Nkrumah</p>
                                        <p>01/03/2025</p>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </form>
                </ng-template>
            </div>
        </div>
    </ng-container>
</div>